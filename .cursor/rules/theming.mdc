---
description: Themeing guides, especially for CSS variables
alwaysApply: false
---
# Theming & Color Schemes

These guidelines apply to all developers and AI agents contributing to **Talis**, a Next.js app for Pen-and-Paper dice rollers.

Talis uses a **two-dimensional theming system** that separates **mode** (light/dark/system) from **theme** (color scheme):

* **Mode** - Controls brightness:
  * `light` - Always use light mode
  * `dark` - Always use dark mode
  * `system` - Respects the user's OS setting (light/dark) and automatically switches

* **Theme** - Controls color scheme, e.g.:
  * `default` - Default Talis color scheme
  * `shadowrun` - Shadowrun-inspired colors
  * `nature` - Nature-inspired colors
  * Additional themes can be added in the future

**Every theme MUST provide both light and dark variants.** The mode selector determines which variant is used.

Implementation notes:

* Use Tailwind v4 utilities and appropriate theme tokens.
* Theming logic should be centralized (e.g. in layout or a theme provider), not per-component.
* Components should:

  * Avoid hard-coded colors.
  * Use theme-aware classes and shadcn/ui tokens.

## Token Semantics (Surface Roles)

Treat palette tokens as **roles**, not extra brand colors. Each theme should follow the same
surface ladder so interactive states are consistent across modes.

**Surface ladder (relative to `--background`)**

1. `--background` - Page base
2. `--card` / `--popover` - Elevated surfaces (small delta from background)
3. `--muted` - Subtle surface (slightly stronger delta than card/popover)
4. `--accent` - Interactive surface (hover/selected/focus backgrounds)
5. `--secondary` - Low-emphasis filled controls (secondary buttons/badges)

**Relationship to `--primary`**

* `--primary` is the brand/action color (CTAs, links, primary buttons).
* `--accent` should **not** be a second brand color by default; it is a **surface state color**
  that sits behind text/icons in menus, lists, and hover states.
* `--secondary` should be **distinct from `--accent`** and less prominent than `--primary`,
  but more visible than `--muted`.
* For custom themes, it is fine if `--accent`/`--secondary` carry a light theme tint (same hue
  family as `--primary`), but their primary job is **state visibility + contrast**, not branding.

## Required CSS Variables

**Every theme MUST define ALL of the following CSS variables** for shadcn/ui components to work correctly. Missing variables will cause components to fall back to `:root` defaults, resulting in inconsistent theming (e.g., sidebar not matching the selected theme).

### Core Variables (2 required)
* `--background` - Main background color
* `--foreground` - Main text color

### Component Variables (4 required)
* `--card` - Card background color
* `--card-foreground` - Card text color
* `--popover` - Popover background color
* `--popover-foreground` - Popover text color

### Color Palette Variables (9 required)
* `--primary` - Primary brand color
* `--primary-foreground` - Text color on primary background
* `--secondary` - Secondary color
* `--secondary-foreground` - Text color on secondary background
* `--muted` - Muted/subtle background color
* `--muted-foreground` - Text color on muted background
* `--accent` - Accent color
* `--accent-foreground` - Text color on accent background
* `--destructive` - Error/destructive action color

### UI Element Variables (3 required)
* `--border` - Border color
* `--input` - Input field background color
* `--ring` - Focus ring color

### Sidebar Variables (8 required)
* `--sidebar` - Sidebar background color
* `--sidebar-foreground` - Sidebar text color
* `--sidebar-primary` - Sidebar primary accent color
* `--sidebar-primary-foreground` - Text color on sidebar primary
* `--sidebar-accent` - Sidebar hover/active accent color
* `--sidebar-accent-foreground` - Text color on sidebar accent
* `--sidebar-border` - Sidebar border color
* `--sidebar-ring` - Sidebar focus ring color

### Chart Variables (5 required)
* `--chart-1` through `--chart-5` - Chart color palette (5 colors)

### Roll Result Variables (4 required)
* `--roll-positive` - Highlight color for rolls that are positive for the player
* `--roll-positive-foreground` - Text/icon color when something sits on top of `--roll-positive`
* `--roll-negative` - Highlight color for rolls that are negative for the player
* `--roll-negative-foreground` - Text/icon color used on top of `--roll-negative`


**Every theme MUST define both light and dark variants.** Each variant requires all variables.

### Color Format

All color values should use the `oklch()` color space format for better color consistency and perceptual uniformity:

```css
--background: oklch(0.15 0 0);
--primary: oklch(0.5 0.2 300);
```

Format: `oklch(lightness chroma hue)`
* **Lightness**: 0-1 (0 = black, 1 = white)
* **Chroma**: 0+ (0 = grayscale, higher = more saturated)
* **Hue**: 0-360 (color wheel position)

### Common Pitfalls

1. **Missing Sidebar Variables**: The most common mistake is forgetting to define `--sidebar-*` variables. This causes the sidebar to use default light theme colors even when a custom theme is selected.

2. **Incomplete Variable Sets**: Only defining a subset of variables (e.g., just `--background` and `--foreground`) will cause inconsistent theming across components.

3. **Color Format Mismatch**: Using hex or RGB values instead of `oklch()` can cause color inconsistencies and make it harder to maintain color relationships.

4. **Typography/Prose Theming**: Tailwind Typography's `prose` class uses hardcoded colors by default. Custom CSS overrides in `app/globals.css` ensure prose styles use theme CSS variables (`--foreground`, `--primary`, `--muted-foreground`, etc.) for all themes. **Do NOT use `dark:prose-invert`** in MDX layouts - prose is already theme-aware through CSS variable overrides.

## Roll Result Color Guidance

Roll-aware variables enable dice rollers (starting with Shadowrun) to surface success and failure states without guessing which palette color fits each theme. When creating or updating a theme:

- `--roll-positive` should provide enough difference to `--primary` pop from any background.
- `--roll-negative` should visually indicate "warning", be less eye-catching than `--roll-positive` and needs to be different from `--destructive`. 
- Foreground counterparts must maintain WCAG AA contrast (4.5:1 for normal text) against their base color.

## Typography & Prose Theming

MDX pages automatically use theme CSS variables via Tailwind Typography's `--tw-prose-*` variables (configured in `app/globals.css`). **Do NOT use `dark:prose-invert`** in MDX layouts - prose is already theme-aware.

MDX layouts should use: `<div className="prose prose-sm md:prose-base">`. Prose elements use `--foreground` (text), `--primary` (links), `--muted-foreground` (muted text), `--muted` (code backgrounds), and `--border` (borders).

## Adding a New Theme Checklist

When introducing a new theme, follow this checklist to keep ThemePicker, branding, and tokens in sync:

1. **CSS variables**
   - Add light and dark blocks in `app/globals.css` using the `[data-theme='NAME'][data-mode='light']` / `[data-theme='NAME'][data-mode='dark']` pattern.
   - Define all required variables (core, component, palette, sidebar, chart, roll result).

2. **Theme type and list**
   - Update `Theme` and `THEMES` in `components/ThemeProvider.tsx` so the app recognizes the new theme.

3. **Branding**
   - Add any logo assets in `public/` and update `lib/theme-config.ts` with `logo` and `brandName` entries.

4. **Localization**
   - Add theme labels in `i18n/en.json` and `i18n/de.json` under the `Theme` namespace.

5. **Preview verification**
   - Confirm the new theme appears in the ThemePicker and that light/dark previews are visually correct.

### CSS Selector Pattern

Themes are applied using combined data attributes: `[data-theme="X"][data-mode="Y"]`

Example:
```css
/* Default theme, light mode */
[data-theme='default'][data-mode='light'] {
  --background: oklch(1 0 0);
  /* ... all 31 variables ... */
}

/* Default theme, dark mode */
[data-theme='default'][data-mode='dark'] {
  --background: oklch(0.145 0 0);
  /* ... all 31 variables ... */
}

/* Shadowrun theme, light mode */
[data-theme='shadowrun'][data-mode='light'] {
  --background: oklch(0.98 0.01 330);
  /* ... all 31 variables ... */
}

/* Shadowrun theme, dark mode */
[data-theme='shadowrun'][data-mode='dark'] {
  --background: oklch(0.15 0.02 330);
  /* ... all 31 variables ... */
}
```

### Reference Implementation

See `app/globals.css` for complete examples of theme definitions:
* `[data-theme='default'][data-mode='light']` - Default theme, light mode
* `[data-theme='default'][data-mode='dark']` - Default theme, dark mode
* `[data-theme='shadowrun'][data-mode='light']` - Shadowrun theme, light mode
* `[data-theme='shadowrun'][data-mode='dark']` - Shadowrun theme, dark mode
* Similar patterns for `nature` and `spm` themes

The `:root` selector is kept as a fallback for default theme light mode when no data attributes are present.

